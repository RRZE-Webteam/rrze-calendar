# RRZE\Calendar\Settings

The objective of this PHP library is to simplify the process of creating settings pages for WordPress plugins. Traditionally, developers have utilized the Settings API or custom code for this purpose. Although the Settings API functions well, it necessitates substantial setup effort. For instance, developers must manually write the HTML code for their options. Additionally, incorporating tabs and tab-sections can become rather complex. This PHP library aims to streamline these tasks and make settings page creation more straightforward.

Based on the package `jeffreyvanrossum/wp-settings`.

## Usage

### Basic example

```php
use RRZE\Calendar\Settings\Settings;

$settings = new Settings(__('My Plugin Settings'));

$tab = $settings->addTab(__('Tab One', 'textdomain'));

$section = $tab->addSection(__('Section One', 'textdomain'));

$section->addOption('text', [
    'name' => 'title',
    'label' => __('Title', 'textdomain')
]);

$settings->build();
```

### Initializing the Settings class

```php
use RRZE\Calendar\Settings\Settings;

$settings = new Settings(__('Custom Settings', 'textdomain'));
```

The constructor supports two parameters, namely `$title` and `$slug`. By default, the page slug is generated by sanitizing the title. If there's a specific slug preference, it can be passed as the second parameter to the constructor.

Additional methods available in this class include:

```php
$settings->setCapability('manage_options')
    ->setOptionName('my_plugin_option')
    ->setMenuTitle(__('My Plugin', 'textdomain'))
    ->setMenuIcon('dashicons-admin-generic')
    ->setMenuPosition(5)
    ->setMenuParentSlug('options-general.php');
```

### Tabs

Tabs will be displayed only if there is more than one tab available.

```php
$settings->addTab(__('General', 'textdomain'));
```

### Sections

The `addSection` method can be called from an instance of `Tab`. It can also be called from the `Settings` instance. Subsequently, it will be added to the last created `Tab`.

```php
$tab->addSection(__('Section One', 'textdomain'));
```

If sections are desired to be displayed as submenu-items, the following can be done:

```php
$tab->addSection('Section One', ['as_link' => true]);
```

Note that this only has an effect when there are more than one `as_link` sections.

### Options

To add an option, you either call the `addOption` method from an instance of `Section`. `addOption` can also be called from the `Settings` instance. The option will then be added to the last created section.

#### Text

```php
$section->addOption('text', [
    'name' => 'option_1',
    'label' => __('Option 1', 'textdomain')
]);
```

#### Textarea

```php
$section->addOption('textarea', [
    'name' => 'option_1',
    'label' => __('Option 1', 'textdomain')
]);
```

#### Checkbox

```php
$section->addOption('checkbox', [
    'name' => 'option_1',
    'label' => __('Option 1', 'textdomain')
]);
```

#### Checkbox Multiple

```php
$section->addOption('checkbox-multiple', [
    'name' => 'multiple_options_1',
    'label' => __('Multiple Options 1', 'textdomain'),
    'options' => [
        'option_1' => __('Option 1', 'rrze-calendar'),
        'option_2' => __('Option 2', 'rrze-calendar')
    ],
]);
```

#### Radio Group

```php
$section->addOption('radio-group', [
    'name' => 'radio_group_1',
    'label' => __('Radio Group 1', 'textdomain'),
    'options' => [
        'option_1' => __('Option 1', 'rrze-calendar'),
        'option_2' => __('Option 2', 'rrze-calendar')
    ],
]);
```

#### Select

```php
$section->addOption('select', [
    'name' => 'option_1',
    'label' => __( 'Option 1', 'textdomain' ),
    'options' => [
        'value_1' => 'Label 1',
        'value_2' => 'Label 2'
    ]
]);
```

#### Select Multiple

```php
$section->addOption('select-multiple', [
    'name' => 'option_1',
    'label' => __('Option 1', 'textdomain'),
    'options' => [
        'value_1' => 'Label 1',
        'value_2' => 'Label 2'
    ]
] );
```

#### Password

```php
$section->addOption('password', [
    'name' => 'password_1',
    'label' => __('Password 1', 'textdomain')
]);
```

### Validate

An option can be validated, allowing for the passing of a callback and a feedback message. Multiple validation rules can be passed as well.

```php
$section->addOption('text', [
    'name' => 'custom_api_key',
    'label' => __('API Key', 'textdomain'),
    'validate' => [
        [
            'feedback' => __('The API key is too short.', 'textdomain'),
            'callback' => fn($value) => strlen($value) > 35
        ]
    ]
]);
```

### Sanitize

A sanitize callback can be passed.

```php
$section->addOption('text', [
    'name' => 'custom_api_key',
    'label' => __('API Key', 'textdomain'),
    'santitize' => fn($value) => sanitize_key($value)
]);
```

### Additional attributes

#### Description

```php
$section->addOption('text', [
    'name' => 'custom_api_key',
    'label' => __('API Key', 'textdomain'),
    'description' => __('Enter the API key here.', 'textdomain')
]);
```

#### Placeholder

```php
$section->addOption('text', [
    'name' => 'custom_api_key',
    'label' => __('API Key', 'textdomain'),
    'placeholder' => __('Enter the API key here.', 'textdomain')
]);
```

#### Default value

```php
$section->addOption('text', [
    'name' => 'custom_api_key',
    'label' => __('API Key', 'textdomain'),
    'default' => 'default_value'
]);
```

#### CSS classes

```php
$section->addOption('text', [
    'name' => 'custom_api_key',
    'label' => __('API Key', 'textdomain'),
    'css' => [
        'label_class' => 'regular-label',
        'input_class' => 'regular-text'
    ]
]);
```

### Hooks

```php
apply_filters('rrze_calendar_settings_new_options', array $newOptions, array $currentOptions)
```

```php
apply_filters('rrze_calendar_settings_new_option_{$optionName}', mixed $value, object \RRZE\Calendar\Settings\Options\Type)
```

```php
apply_filters('rrze_calendar_settings_option_type_map', array $optionTypeMap)
```

```php
apply_filters('rrze_calendar_settings_template_include', string $fileName, array $vars)
```

```php
do_action('rrze_calendar_settings_after_update_option', string $optionName, array $options)
```

### Adding a custom option type

To add a custom option type, the `rrze_calendar_settings_option_type_map` filter can be used.

```php
add_filter('rrze_calendar_settings_option_type_map', function($options){
    $options['custom'] = MyCustomOption::class;
    return $options;
});
```

Next, the class `MyCustomOption` must be added for the custom option type.

```php
use RRZE\Calendar\Settings\Options\Type;

class MyCustomOption extends Type
{
    public $template = 'custom-option';

    public function render()
    {
        echo 'My custom option HTML';
    }
}
```

Once registered, the option type can be used as follows:

```php
$settings->addOption('custom-option', [
    'name' => 'my_option_name',
    'label' => __('My label', 'textdomain')
]);
```
